package org.example;
import org.bouncycastle.util.encoders.Hex;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
// EXERCICIO 04 CRYPTOPALS
public class singleByteCipher {
    private static final Map<Character, Integer> FREQUENCIA_LETRAS = new HashMap<>();
    static {
        // Utilizei o mesmo mapa da questão 3
        FREQUENCIA_LETRAS.put(' ', 1800);
        FREQUENCIA_LETRAS.put('a', 757); FREQUENCIA_LETRAS.put('b', 184);
        FREQUENCIA_LETRAS.put('c', 409); FREQUENCIA_LETRAS.put('d', 338);
        FREQUENCIA_LETRAS.put('e', 1151); FREQUENCIA_LETRAS.put('f', 123);
        FREQUENCIA_LETRAS.put('g', 270); FREQUENCIA_LETRAS.put('h', 232);
        FREQUENCIA_LETRAS.put('i', 901); FREQUENCIA_LETRAS.put('j', 16);
        FREQUENCIA_LETRAS.put('k', 85); FREQUENCIA_LETRAS.put('l', 531);
        FREQUENCIA_LETRAS.put('m', 284); FREQUENCIA_LETRAS.put('n', 685);
        FREQUENCIA_LETRAS.put('o', 659); FREQUENCIA_LETRAS.put('p', 294);
        FREQUENCIA_LETRAS.put('q', 16); FREQUENCIA_LETRAS.put('r', 707);
        FREQUENCIA_LETRAS.put('s', 952); FREQUENCIA_LETRAS.put('t', 668);
        FREQUENCIA_LETRAS.put('u', 327); FREQUENCIA_LETRAS.put('v', 98);
        FREQUENCIA_LETRAS.put('w', 74); FREQUENCIA_LETRAS.put('x', 29);
        FREQUENCIA_LETRAS.put('y', 163); FREQUENCIA_LETRAS.put('z', 47);
    }

    // record para guardar dados da linha
    public record Decifragem(String textoDecifrado, int pontuacao, byte chave, int numeroLinha) {}



    public static void main(String[] args) {
        // Guardei as cifras em uma lista, pois achei que ficaria mais fácil assim,
        // código ganhou linhas por não ter importado um arquivo, mas prefiro usando essa logica
        List<String> hexLista = List.of(
                "1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736",
                "7b5a4215415d544115415d5015455447414c155c46155f4058455c5b523f",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "636f6d6d6f6e206b6e6f776c65646765206f6620746865206c6177206973206e6f74",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "206120636f6d706c696d656e7420746f2061206d616e277320636861726163746572",
                "322d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "78397828372d363c78373e783a393b3736",
                "3978243b23783431333d78397828372d363c78373e783a393b3736",
                "206b6e6f776c65646765206f6620746865206c6177206973206e6f74"

        );

        Decifragem melhorResultado = null;
        int linhaAtual = 0;

        for (String hexLinha : hexLista) {
            linhaAtual++;
            Decifragem resultadoLinha = decifraByteCifra(hexLinha, linhaAtual);

            if (melhorResultado == null || resultadoLinha.pontuacao() > melhorResultado.pontuacao()) {
                melhorResultado = resultadoLinha;
            }
        }

        if (melhorResultado != null) {
            System.out.println("Linha: " + melhorResultado.numeroLinha());
            System.out.printf("Chave: %c\n", (char) melhorResultado.chave());
            System.out.println("Pontuação: " + melhorResultado.pontuacao());
            System.out.println("Texto: " + melhorResultado.textoDecifrado());
        }
    }
    public static Decifragem decifraByteCifra(String linhaHex, int numeroLinha) {
        byte[] cifra = Hex.decode(linhaHex);
        Decifragem melhorDecifragemLinha = null;

        for (int key = 0; key < 256; key++) {
            byte[] textoBytes = new byte[cifra.length];
            for (int i = 0; i < cifra.length; i++) {
                textoBytes[i] = (byte) (cifra[i] ^ key);
            }
            int pontuacaoAtual = pontuacaoTexto(textoBytes);
            if (melhorDecifragemLinha == null || pontuacaoAtual > melhorDecifragemLinha.pontuacao()) {
                melhorDecifragemLinha = new Decifragem(new String(textoBytes), pontuacaoAtual, (byte) key, numeroLinha);
            }
        }
        return melhorDecifragemLinha;
    }
// mesmo da questao 3
    public static int pontuacaoTexto(byte[] textoBytes) {
        int pontuacao = 0;
        for (byte b : textoBytes) {
            char c = (char) b;
            char transformarMinusculo = Character.toLowerCase(c);

            // Pontos são acumulados
            pontuacao += FREQUENCIA_LETRAS.getOrDefault(transformarMinusculo, 0);

            // Tiro pontos de textos com caracteres não usados na lingua inglesa para melhores resultados
            if (!Character.isLetterOrDigit(c) && !Character.isWhitespace(c) && c != '\'' && c != ',' && c != '.') {
                pontuacao -= 5;
            }
        }
        return pontuacao;
    }
}